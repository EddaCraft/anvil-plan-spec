# APS Agents Design — Wave 1 + 2

**Date:** 2026-02-21
**Scope:** AGENT-001, AGENT-002, AGENT-005 (partial)
**Branch:** feat/agents

## Architecture

Single source + build. Core prompts in `scaffold/agents/core/` as plain
markdown. Tool variants generated by wrapping core in tool-specific frontmatter.

```text
scaffold/agents/
├── core/
│   ├── planner-core.md
│   └── librarian-core.md
├── claude-code/
│   ├── aps-planner.md
│   └── aps-librarian.md
└── build.sh
```

## Planner Agent (AGENT-001)

Derived from code-env `anvil-plan-spec.md`, adapted for distribution:

- Strip personal assumptions and code-env paths
- Reference `plans/` (per D-017)
- Model: opus | Tools: Read, Write, Edit, Glob, Grep, Bash, Task
- Covers: install/update, hierarchy, decision tree, templates, status,
  wave execution, validation

## Librarian Agent (AGENT-002)

Derived from code-env `librarian.md`, adapted for distribution:

- Same adaptation as planner
- Model: sonnet | Tools: Read, Write, Edit, Glob, Grep, Bash
- Covers: audit, archive, orphan detection, cross-refs, filing

## Build Script

`scaffold/agents/build.sh` concatenates frontmatter + core per tool.
Wave 1+2 generates Claude Code only. Other tools added in Waves 3-4.

## Documentation (AGENT-005 partial)

`docs/agents.md` — what each agent does, when to use, how to invoke in
Claude Code, model cost implications.

## Install Integration

Deferred to INSTALL-003. For now, agent files are manually copied to
`.claude/agents/`. Documented in agents.md.

## Decisions

- D-016: Planner = planning + execution + status + waves.
  Librarian = archiving + cross-refs + orphans. No overlap.
- D-017: Agents reference `plans/` and `aps-planning/scripts/`.
- D-018: Shared core prompt, tool-specific wrappers.
